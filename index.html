<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìµœíƒœì› íšŒì¥ë‹˜ ì±—ë´‡</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f2f2f2;
      padding: 3rem;
      margin: 0;
    }
    .character {
      position: relative;
      display: inline-block;
      max-width: 90vw;
    }
    .bubble {
      position: absolute;
      top: -130px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 20px;
      border: 2px solid #888;
      width: 80vw;
      max-width: 320px;
      font-size: 1rem;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
    }
    .character img {
      width: 70vw;
      max-width: 250px;
      height: auto;
      transition: 0.2s;
    }
    button, input[type="text"] {
      margin-top: 2rem;
      font-size: 1.1rem;
      padding: 1rem;
      width: 80%;
      max-width: 400px;
    }
    input[type="text"] {
      margin-bottom: 1rem;
    }
    @media (max-width: 600px) {
      body {
        padding: 1.5rem;
      }
      .bubble {
        font-size: 0.95rem;
      }
      button, input[type="text"] {
        font-size: 1rem;
        padding: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <h1>ìµœíƒœì› íšŒì¥ë‹˜ ìŒì„± ì±—ë´‡</h1>
  <div class="character">
    <div class="bubble" id="bubble">ë¬´ì—‡ì´ë“  ì§ˆë¬¸í•´ë³´ì„¸ìš”!</div>
    <img id="face" src="mouth_closed.png" alt="íšŒì¥ë‹˜ ìºë¦­í„°">
  </div>
  <br>
  <input type="text" id="textInput" placeholder="ì±„íŒ…ìœ¼ë¡œ ì§ˆë¬¸í•´ë³´ì„¸ìš”">
  <br>
  <button onclick="handleTextInput()">ğŸ’¬ ì§ˆë¬¸í•˜ê¸°</button>
  <button onclick="startListening()">ğŸ¤ ìŒì„±ìœ¼ë¡œ ì§ˆë¬¸í•˜ê¸°</button>

  <script>
    const qaMap = {
      "ì¡°ë¯¸í™”": "ì¡°ë¯¸í™” ë§¤ë‹ˆì €ë‹˜ì€ 1991ë…„ìƒ ì–‘ë ë¡œ, ì „ ì›Œí¬ìƒµ ì¤€ë¹„ìœ„ì›íšŒ ìœ„ì›ì´ì—ˆê³  í˜„ì¬ëŠ” í¬ìƒì¤€ë¹„ìœ„ì›íšŒì—ì„œ í™œì•½ ì¤‘ì´ì—ìš”. ì•„ë²„ë‹˜ì€ ë‚˜ë¬´ë¥¼ ê°€ê¾¸ì‹œê³ , ì•„ê¸° ë“±ì›ì„ ìœ„í•˜ì—¬ íšŒì‚¬ ê·¼ì²˜ë¡œ ì´ì‚¬ì˜¤ì‹  ë¶„ì´ì—ìš”.",
      "ë°±ìŠ¹íš¨": "ë°±ìŠ¹íš¨ íŒ€ì¥ë‹˜ì€ ì–‘ë ë¡œ, ëª¨ë°”ì¼ì œíœ´ì˜ì—…íŒ€ì˜ ìˆ˜ì¥ì´ì ëŒ€í˜• ì»¤í”¼ í”„ëœì°¨ì´ì¦ˆì˜ ì‚¬ëª¨ë‹˜ìœ¼ë¡œë„ ì•Œë ¤ì ¸ ìˆì–´ìš”. ì •ì¹˜ìƒ‰ì€ ë°íˆì§€ ì•Šì§€ë§Œ, ì‚¬ì ì¸ ì´ì•¼ê¸°ì—ëŠ” ê½¤ ì†”ì§í•˜ê²Œ ë§ì”€í•˜ì‹œëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”.",
      "ìŠ¤í† ì•„": "ìŠ¤í† ì•„ëŠ” SKê·¸ë£¹ ê³„ì—´ì˜ Tì»¤ë¨¸ìŠ¤ ì „ë¬¸ ê¸°ì—…ìœ¼ë¡œ, TVë¿ ì•„ë‹ˆë¼ ëª¨ë°”ì¼ê³¼ ì˜¨ë¼ì¸ í”Œë«í¼ì—ì„œ ì‡¼í•‘ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ì¢…í•© ë¯¸ë””ì–´ì»¤ë¨¸ìŠ¤ íšŒì‚¬ì˜ˆìš”. 2017ë…„ì— ì„¤ë¦½ë˜ì–´ 2018ë…„ë¶€í„° ë°©ì†¡ì„ ì‹œì‘í–ˆê³ , ë‹¤ì–‘í•œ ì±„ë„ê³¼ ì•±ì„ í†µí•´ ì„œë¹„ìŠ¤í•˜ë©° ìˆ˜í‰ì ì´ê³  ììœ¨ì ì¸ ë¬¸í™”ë¥¼ ê°€ì§€ê³  ìˆì–´ìš”. ë³µì§€ë„ ìš°ìˆ˜í•˜ê³ , ë‹¤ì–‘í•œ íŒ€ì´ í˜‘ë ¥í•´ ìš´ì˜ë˜ê³  ìˆìœ¼ë©°, ê³ ê° ì¤‘ì‹¬ê³¼ ì§€ì† ê°€ëŠ¥í•œ ê°€ì¹˜ë¥¼ í•µì‹¬ ì² í•™ìœ¼ë¡œ ì‚¼ê³  ìˆì–´ìš”."
    };

    const bubble = document.getElementById("bubble");
    const face = document.getElementById("face");
    const textInput = document.getElementById("textInput");
    const closedMouth = "mouth_closed.png";
    const openMouth = "mouth_open.png";
    let speakingInterval = null;
    let preferredVoice = null;

    function animateMouth(open = true) {
      if (open) {
        let toggle = false;
        speakingInterval = setInterval(() => {
          face.src = toggle ? openMouth : closedMouth;
          toggle = !toggle;
        }, 250);
      } else {
        clearInterval(speakingInterval);
        face.src = closedMouth;
      }
    }

    function getAnswer(transcript) {
      transcript = transcript.trim().replace(/\s/g, "");
      for (const key in qaMap) {
        if (transcript.includes(key.replace(/\s/g, ""))) {
          return qaMap[key];
        }
      }
      return "ì£„ì†¡í•©ë‹ˆë‹¤. ê·¸ ì§ˆë¬¸ì€ ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.";
    }

    function speak(text) {
      bubble.innerText = text;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "ko-KR";

      if (preferredVoice) {
        utter.voice = preferredVoice;
      }

      animateMouth(true);
      utter.onend = () => animateMouth(false);
      window.speechSynthesis.speak(utter);
    }

    function handleTextInput() {
      const input = textInput.value.trim();
      if (!input) return;
      const answer = getAnswer(input);
      speak(answer);
      textInput.value = "";
    }

    function startListening() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = "ko-KR";
      recognition.interimResults = true;
      recognition.maxAlternatives = 3;

      bubble.innerText = "ë“£ê³  ìˆì–´ìš”... ğŸ§";
      recognition.start();

      recognition.onresult = function(event) {
        const results = event.results;
        let transcript = "";
        for (let i = results.length - 1; i >= 0; i--) {
          if (results[i].isFinal) {
            transcript = results[i][0].transcript;
            break;
          }
        }
        if (!transcript && results[0]) {
          transcript = results[0][0].transcript;
        }
        transcript = transcript.trim();
        const answer = getAnswer(transcript);
        speak(answer);
      };

      recognition.onerror = function(event) {
        bubble.innerText = "ìŒì„± ì¸ì‹ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.";
      };
    }

    window.speechSynthesis.onvoiceschanged = () => {
      const voices = window.speechSynthesis.getVoices();
      const maleVoiceCandidates = voices.filter(v =>
        v.lang === "ko-KR" && (v.name.includes("ë‚¨ì„±") || v.name.toLowerCase().includes("male") || v.name.includes("Wavenet-C") || v.name.includes("B") || v.name.includes("Google") || v.name.includes("Microsoft") )
      );
      preferredVoice = maleVoiceCandidates.find(v => v.name.includes("Google í•œêµ­ì˜ ë‚¨ì„±")) || maleVoiceCandidates[0];
    };
  </script>
</body>
</html>
